# name: EnV-if-file
# on:
#   workflow_dispatch:
#     inputs:
#       environment:
#         type: choice
#         description: this is for testing
#         options:
#           - prod
#           - stage
#           - dev
#         default: prod
# jobs:
#   SET-env:
#     runs-on: ubuntu-latest
#     steps:
#     - name: Set ENV_NAME to production if input is prod
#       if: ${{ github.event.inputs.environment == 'prod' }}
#       run: echo "ENV_NAME=production" >> $GITHUB_ENV

#     - name: Set ENV_NAME to staging if not prod
#       if: ${{ github.event.inputs.target != 'prod' }}
#       run: echo "ENV_NAME=staging" >> $GITHUB_ENV

#     - name: Print final ENV_NAME
#       run: echo "ENV_NAME is $ENV_NAME"
     
name: Global Env via Job Outputs

on:
  workflow_dispatch:
    inputs:
      target:
        description: "Target environment"
        required: true
        default: dev
        type: choice
        options:
          - dev
          - prod

jobs:
  setup:
    runs-on: ubuntu-latest
    outputs:
      env_name: ${{ steps.setenv.outputs.env_name }}
    steps:
      - name: Set ENV_NAME based on input
        id: setenv
        run: |
          if [[ "${{ github.event.inputs.target }}" == "prod" ]]; then
            echo "env_name=true" >> $GITHUB_OUTPUT
          else
            echo "env_name=false" >> $GITHUB_OUTPUT
          fi

  use-env:
    runs-on: ubuntu-latest
    needs: setup
    env:
      ENV_NAME: ${{ needs.setup.outputs.env_name }}
    steps:
      - name: Print the environment name
        run: |
          echo "Using ENV_NAME: $ENV_NAME"